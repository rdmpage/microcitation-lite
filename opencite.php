<?php

//----------------------------------------------------------------------------------------
function get($url, $content_type = '')
{	
	$data = null;

	$opts = array(
	  CURLOPT_URL =>$url,
	  CURLOPT_FOLLOWLOCATION => TRUE,
	  CURLOPT_RETURNTRANSFER => TRUE,
	  
	  CURLOPT_HEADER 		=> FALSE,
	  
	  CURLOPT_SSL_VERIFYHOST=> FALSE,
	  CURLOPT_SSL_VERIFYPEER=> FALSE,
	  
	  CURLOPT_COOKIEJAR=> sys_get_temp_dir() . '/cookies.txt',
	  CURLOPT_COOKIEFILE=> sys_get_temp_dir() . '/cookies.txt',
	  
	);

	if ($content_type != '')
	{
		$opts[CURLOPT_HTTPHEADER] = array(
			"Accept: " . $content_type, 
			"Accept-Language: en-gb",
			"User-agent: Mozilla/5.0 (iPad; U; CPU OS 3_2_1 like Mac OS X; en-us) AppleWebKit/531.21.10 (KHTML, like Gecko) Mobile/7B405" 
		);
	}
	
	$ch = curl_init();
	curl_setopt_array($ch, $opts);
	$data = curl_exec($ch);
	$info = curl_getinfo($ch); 
	curl_close($ch);
	
	// echo $data;
	
	return $data;
}

//----------------------------------------------------------------------------------------

$dois = array(

'10.5962/p.171599',
'10.5962/p.171600',
'10.5962/p.171601',
'10.5962/p.171602',
'10.5962/p.171603',
'10.5962/p.171604',
'10.5962/p.171605',
'10.5962/p.171606',
'10.5962/p.171607',
'10.5962/p.171608',
'10.5962/p.171609',
'10.5962/p.171610',
'10.5962/p.171611',
'10.5962/p.171612',
'10.5962/p.171613',
'10.5962/p.171859',
'10.5962/p.171860',
'10.5962/p.171861',
'10.5962/p.171862',
'10.5962/p.171863',
'10.5962/p.171864',
'10.5962/p.171865',
'10.5962/p.171866',
'10.5962/p.171867',
'10.5962/p.171868',
'10.5962/p.171869',
'10.5962/p.171870',
'10.5962/p.171871',
'10.5962/p.171872',
'10.5962/p.171873',
'10.5962/p.171874',
'10.5962/p.171875',
'10.5962/p.171876',
'10.5962/p.171877',
'10.5962/p.171878',
'10.5962/p.171879',
'10.5962/p.171880',
'10.5962/p.171881',
'10.5962/p.171882',
'10.5962/p.171883',
'10.5962/p.171884',
'10.5962/p.171885',
'10.5962/p.171886',
'10.5962/p.171887',
'10.5962/p.171888',
'10.5962/p.171889',
'10.5962/p.171890',
'10.5962/p.171891',
'10.5962/p.171892',
'10.5962/p.171893',
'10.5962/p.171894',
'10.5962/p.171895',
'10.5962/p.171896',
'10.5962/p.171897',
'10.5962/p.171898',
'10.5962/p.171899',
'10.5962/p.171900',
'10.5962/p.171901',
'10.5962/p.171902',
'10.5962/p.171903',
'10.5962/p.171904',
'10.5962/p.171905',
'10.5962/p.171906',
'10.5962/p.171907',
'10.5962/p.171908',
'10.5962/p.171909',
'10.5962/p.171910',
'10.5962/p.171911',
'10.5962/p.171912',
'10.5962/p.171913',
'10.5962/p.171914',
'10.5962/p.171915',
'10.5962/p.171916',
'10.5962/p.171917',
'10.5962/p.171918',
'10.5962/p.171919',
'10.5962/p.171920',
'10.5962/p.171921',
'10.5962/p.171922',
'10.5962/p.171923',
'10.5962/p.171924',
'10.5962/p.171925',
'10.5962/p.171926',
'10.5962/p.171927',
'10.5962/p.171928',
'10.5962/p.171929',
'10.5962/p.171930',
'10.5962/p.171931',
'10.5962/p.171932',
'10.5962/p.171933',
'10.5962/p.184017',
'10.5962/p.184018',
'10.5962/p.184019',
'10.5962/p.184020',
'10.5962/p.184021',
'10.5962/p.184022',
'10.5962/p.184023',
'10.5962/p.184024',
'10.5962/p.184025',
'10.5962/p.184026',
'10.5962/p.184027',
'10.5962/p.184028',
'10.5962/p.184029',
'10.5962/p.184030',
'10.5962/p.184031',
'10.5962/p.184032',
'10.5962/p.184033',
'10.5962/p.184034',
'10.5962/p.184035',
'10.5962/p.184036',
'10.5962/p.184037',
'10.5962/p.184038',
'10.5962/p.184039',
'10.5962/p.184040',
'10.5962/p.184041',
'10.5962/p.184042',
'10.5962/p.184043',
'10.5962/p.184044',
'10.5962/p.184045',
'10.5962/p.184046',
'10.5962/p.184047',
'10.5962/p.184048',
'10.5962/p.184049',
'10.5962/p.184050',
'10.5962/p.184051',
'10.5962/p.184052',
'10.5962/p.184053',
'10.5962/p.184054',
'10.5962/p.184055',
'10.5962/p.184056',
'10.5962/p.184057',
'10.5962/p.184058',
'10.5962/p.184059',
'10.5962/p.184060',
'10.5962/p.184061',
'10.5962/p.184062',
'10.5962/p.184063',
'10.5962/p.184064',
'10.5962/p.184065',
'10.5962/p.184066',
'10.5962/p.184067',
'10.5962/p.184068',
'10.5962/p.184069',
'10.5962/p.184070',
'10.5962/p.184071',
'10.5962/p.184072',
'10.5962/p.184073',
'10.5962/p.184074',
'10.5962/p.184075',
'10.5962/p.184076',
'10.5962/p.184077',
'10.5962/p.184078',
'10.5962/p.184079',
'10.5962/p.184080',
'10.5962/p.184081',
'10.5962/p.184082',
'10.5962/p.190407',
'10.5962/p.190408',
'10.5962/p.190409',
'10.5962/p.190410',
'10.5962/p.190411',
'10.5962/p.190412',
'10.5962/p.190413',
'10.5962/p.190414',
'10.5962/p.190415',
'10.5962/p.198393',
'10.5962/p.198394',
'10.5962/p.198395',
'10.5962/p.198396',
'10.5962/p.198397',
'10.5962/p.198398',
'10.5962/p.198399',
'10.5962/p.198400',
'10.5962/p.198401',
'10.5962/p.198402',
'10.5962/p.198403',
'10.5962/p.198404',
'10.5962/p.198405',
'10.5962/p.198406',
'10.5962/p.198407',
'10.5962/p.198408',
'10.5962/p.198409',
'10.5962/p.198410',
'10.5962/p.198411',
'10.5962/p.198412',
'10.5962/p.198413',
'10.5962/p.198414',
'10.5962/p.198415',
'10.5962/p.198416',
'10.5962/p.198417',
'10.5962/p.198418',
'10.5962/p.198419',
'10.5962/p.198420',
'10.5962/p.198421',
'10.5962/p.198422',
'10.5962/p.198423',
'10.5962/p.198424',
'10.5962/p.198425',
'10.5962/p.198426',
'10.5962/p.198427',
'10.5962/p.198428',
'10.5962/p.198429',
'10.5962/p.198430',
'10.5962/p.198431',
'10.5962/p.198432',
'10.5962/p.198433',
'10.5962/p.198434',
'10.5962/p.198435',
'10.5962/p.198436',
'10.5962/p.198437',
'10.5962/p.198438',
'10.5962/p.198439',
'10.5962/p.198440',
'10.5962/p.198441',
'10.5962/p.198442',
'10.5962/p.198443',
'10.5962/p.198444',
'10.5962/p.198445',
'10.5962/p.198446',
'10.5962/p.198447',
'10.5962/p.198448',
'10.5962/p.198449',
'10.5962/p.198450',
'10.5962/p.198451',
'10.5962/p.198452',
'10.5962/p.198453',
'10.5962/p.198454',
'10.5962/p.198455',
'10.5962/p.198456',
'10.5962/p.198457',
'10.5962/p.198458',
'10.5962/p.198459',
'10.5962/p.198460',
'10.5962/p.198461',
'10.5962/p.198462',
'10.5962/p.198463',
'10.5962/p.198464',
'10.5962/p.198465',
'10.5962/p.198466',
'10.5962/p.198467',
'10.5962/p.198468',
'10.5962/p.198469',
'10.5962/p.198470',
'10.5962/p.198471',
'10.5962/p.198472',
'10.5962/p.198473',
'10.5962/p.198474',
'10.5962/p.198475',
'10.5962/p.198476',
'10.5962/p.198477',
'10.5962/p.198478',
'10.5962/p.198479',
'10.5962/p.198480',
'10.5962/p.198481',
'10.5962/p.198482',
'10.5962/p.198483',
'10.5962/p.198484',
'10.5962/p.198485',
'10.5962/p.198486',
'10.5962/p.198487',
'10.5962/p.198488',
'10.5962/p.198489',
'10.5962/p.198490',
'10.5962/p.198491',
'10.5962/p.198492',
'10.5962/p.198493',
'10.5962/p.198494',
'10.5962/p.198495',
'10.5962/p.198496',
'10.5962/p.198497',
'10.5962/p.198498',
'10.5962/p.198499',
'10.5962/p.198500',
'10.5962/p.198501',
'10.5962/p.198502',
'10.5962/p.198503',
'10.5962/p.198504',
'10.5962/p.198505',
'10.5962/p.198506',
'10.5962/p.198507',
'10.5962/p.198508',
'10.5962/p.198509',
'10.5962/p.198510',
'10.5962/p.198511',
'10.5962/p.198512',
'10.5962/p.198513',
'10.5962/p.198514',
'10.5962/p.198515',
'10.5962/p.198516',
'10.5962/p.198517',
'10.5962/p.198518',
'10.5962/p.198519',
'10.5962/p.198520',
'10.5962/p.198521',
'10.5962/p.198522',
'10.5962/p.198523',
'10.5962/p.198524',
'10.5962/p.198525',
'10.5962/p.237613',
'10.5962/p.237615',
'10.5962/p.237614',
'10.5962/p.237616',
'10.5962/p.237617',
'10.5962/p.237618',
'10.5962/p.237619',
'10.5962/p.237620',
'10.5962/p.237621',
'10.5962/p.237624',
'10.5962/p.237625',
'10.5962/p.237626',
'10.5962/p.237627',
'10.5962/p.237628',
'10.5962/p.237629',
'10.5962/p.237630',
'10.5962/p.237631',
'10.5962/p.237632',
'10.5962/p.237633',
'10.5962/p.237634',
'10.5962/p.237635',
'10.5962/p.237636',
'10.5962/p.237637',
'10.5962/p.237638',
'10.5962/p.237639',
'10.5962/p.237640',
'10.5962/p.237641',
'10.5962/p.237642',
'10.5962/p.237643',
'10.5962/p.237644',
'10.5962/p.237645',
'10.5962/p.237646',
'10.5962/p.237647',
'10.5962/p.237648',
'10.5962/p.237649',
'10.5962/p.237650',
'10.5962/p.237652',
'10.5962/p.237651',
'10.5962/p.237653',
'10.5962/p.237654',
'10.5962/p.237655',
'10.5962/p.237656',
'10.5962/p.237657',
'10.5962/p.237658',
'10.5962/p.237659',
'10.5962/p.237660',
'10.5962/p.237661',
'10.5962/p.238362',
'10.5962/p.238363',
'10.5962/p.238364',
'10.5962/p.238365',
'10.5962/p.238366',
'10.5962/p.238367',
'10.5962/p.238368',
'10.5962/p.238369',
'10.5962/p.238361',
'10.5962/p.238370',
'10.5962/p.238371',
'10.5962/p.238372',
'10.5962/p.238373',
'10.5962/p.238374',
'10.5962/p.238375',
'10.5962/p.238376',
'10.5962/p.238377',
'10.5962/p.238378',
'10.5962/p.238379',
'10.5962/p.238380',
'10.5962/p.238381',
'10.5962/p.238382',
'10.5962/p.238383',
'10.5962/p.238384',
'10.5962/p.238385',
'10.5962/p.238386',
'10.5962/p.238387',
'10.5962/p.238388',
'10.5962/p.238389',
'10.5962/p.238390',
'10.5962/p.238391',
'10.5962/p.238393',
'10.5962/p.238392',
'10.5962/p.238394',
'10.5962/p.238395',
'10.5962/p.238397',
'10.5962/p.254654',
'10.5962/p.254655',
'10.5962/p.254657',
'10.5962/p.254656',
'10.5962/p.254658',
'10.5962/p.254659',
'10.5962/p.254660',
'10.5962/p.254661',
'10.5962/p.238396',
'10.5962/p.254662',
'10.5962/p.254663',
'10.5962/p.254664',
'10.5962/p.254916',
'10.5962/p.254917',
'10.5962/p.254918',
'10.5962/p.254919',
'10.5962/p.254920',
'10.5962/p.254921',
'10.5962/p.254922',
'10.5962/p.254923',
'10.5962/p.254924',
'10.5962/p.254925',
'10.5962/p.254927',
'10.5962/p.254928',
'10.5962/p.291360',
'10.5962/p.291361',
'10.5962/p.291362',
'10.5962/p.291363',
'10.5962/p.291364',
'10.5962/p.291365',
'10.5962/p.291366',
'10.5962/p.291367',
'10.5962/p.291368',
'10.5962/p.291369',
'10.5962/p.254926',
'10.5962/p.291370',
'10.5962/p.291371',
'10.5962/p.291372',
'10.5962/p.291373',
'10.5962/p.291559',
'10.5962/p.291561',
'10.5962/p.291562',
'10.5962/p.291563',
'10.5962/p.291564',
'10.5962/p.291565',
'10.5962/p.291567',
'10.5962/p.291568',
'10.5962/p.291569',
'10.5962/p.291570',
'10.5962/p.291571',
'10.5962/p.291560',
'10.5962/p.291572',
'10.5962/p.291573',
'10.5962/p.291574',
'10.5962/p.291575',
'10.5962/p.291577',
'10.5962/p.291578',
'10.5962/p.291566',
'10.5962/p.291579',
'10.5962/p.291580',
'10.5962/p.291581',
'10.5962/p.291582',
'10.5962/p.291583',
'10.5962/p.291584',
'10.5962/p.291585',
'10.5962/p.291586',
'10.5962/p.291587',
'10.5962/p.291945',
'10.5962/p.291946',
'10.5962/p.291576',
'10.5962/p.291947',
'10.5962/p.291948',
'10.5962/p.291949',
'10.5962/p.291950',
'10.5962/p.291951',
'10.5962/p.291952',
'10.5962/p.291953',
'10.5962/p.291954',
'10.5962/p.291955',
'10.5962/p.291956',
'10.5962/p.291957',
'10.5962/p.291958',
'10.5962/p.291959',
'10.5962/p.291960',
'10.5962/p.291961',
'10.5962/p.291963',
'10.5962/p.291964',
'10.5962/p.291965',
'10.5962/p.291966',
'10.5962/p.291967',
'10.5962/p.291968',
'10.5962/p.291969',
'10.5962/p.291970',
'10.5962/p.291971',
'10.5962/p.291972',
'10.5962/p.291973',
'10.5962/p.291974',
'10.5962/p.291975',
'10.5962/p.291976',
'10.5962/p.291977',
'10.5962/p.291978',
'10.5962/p.291979',
'10.5962/p.291980',
'10.5962/p.291981',
'10.5962/p.291982',
'10.5962/p.291983',
'10.5962/p.291984',
'10.5962/p.291985',
'10.5962/p.291986',
'10.5962/p.291962',
'10.5962/p.292234',
'10.5962/p.292235',
'10.5962/p.292236',
'10.5962/p.292237',
'10.5962/p.292238',
'10.5962/p.292239',
'10.5962/p.292240',
'10.5962/p.292241',
'10.5962/p.292242',
'10.5962/p.292243',
'10.5962/p.292244',
'10.5962/p.292245',
'10.5962/p.292233',
'10.5962/p.292246',
'10.5962/p.292248',
'10.5962/p.292249',
'10.5962/p.292250',
'10.5962/p.292251',
'10.5962/p.292252',
'10.5962/p.292254',
'10.5962/p.292255',
'10.5962/p.292256',
'10.5962/p.292257',
'10.5962/p.292258',
'10.5962/p.292259',
'10.5962/p.292247',
'10.5962/p.292260',
'10.5962/p.292261',
'10.5962/p.292262',
'10.5962/p.292263',
'10.5962/p.292264',
'10.5962/p.292265',
'10.5962/p.292253',
'10.5962/p.292266',
'10.5962/p.292267',
'10.5962/p.292268',
'10.5962/p.292269',
'10.5962/p.292270',
'10.5962/p.292271',
'10.5962/p.292488',
'10.5962/p.292489',
'10.5962/p.292490',
'10.5962/p.292491',
'10.5962/p.292492',
'10.5962/p.292493',
'10.5962/p.292494',
'10.5962/p.292495',
'10.5962/p.292496',
'10.5962/p.292497',
'10.5962/p.292498',
'10.5962/p.292499',
'10.5962/p.292500',
'10.5962/p.292502',
'10.5962/p.292503',
'10.5962/p.292504',
'10.5962/p.292505',
'10.5962/p.292501',
'10.5962/p.292506',
'10.5962/p.292507',
'10.5962/p.292508',
'10.5962/p.292509',
'10.5962/p.292510',
'10.5962/p.292511',
'10.5962/p.292512',
'10.5962/p.292513',
'10.5962/p.292514',
'10.5962/p.292515',
'10.5962/p.292516',
'10.5962/p.292517',
'10.5962/p.292518',
'10.5962/p.292519',
'10.5962/p.292520',
'10.5962/p.292521',
'10.5962/p.292522',
'10.5962/p.292523',
'10.5962/p.295674',
'10.5962/p.295675',
'10.5962/p.295676',
'10.5962/p.295677',
'10.5962/p.295678',
'10.5962/p.295679',
'10.5962/p.295680',
'10.5962/p.295681',
'10.5962/p.295682',
'10.5962/p.295683',
'10.5962/p.295684',
'10.5962/p.295685',
'10.5962/p.295686',
'10.5962/p.295687',
'10.5962/p.295689',
'10.5962/p.295690',
'10.5962/p.295691',
'10.5962/p.337548',
'10.5962/p.337549',
'10.5962/p.337550',
'10.5962/p.337551',
'10.5962/p.295688',
'10.5962/p.337552',
'10.5962/p.337553',
'10.5962/p.337554',
'10.5962/p.337555',
'10.5962/p.337556',
'10.5962/p.337557',
'10.5962/p.337558',
'10.5962/p.337559',
'10.5962/p.337560',
'10.5962/p.337561',
'10.5962/p.337562',
'10.5962/p.337563',
'10.5962/p.337564',
'10.5962/p.337565',
'10.5962/p.337566',
'10.5962/p.337568',
'10.5962/p.337569',
'10.5962/p.337570',
'10.5962/p.337571',
'10.5962/p.337572',
'10.5962/p.337567',
'10.5962/p.337573',
'10.5962/p.337574',
'10.5962/p.337575',
'10.5962/p.337576',
'10.5962/p.337578',
'10.5962/p.337579',
'10.5962/p.337580',
'10.5962/p.337581',
'10.5962/p.337582',
'10.5962/p.337583',
'10.5962/p.337584',
'10.5962/p.337585',
'10.5962/p.337620',
'10.5962/p.340564',
'10.5962/p.340565',
'10.5962/p.340566',
'10.5962/p.340567',
'10.5962/p.340568',
'10.5962/p.340569',
'10.5962/p.340570',
'10.5962/p.340571',
'10.5962/p.340572',
'10.5962/p.340573',
'10.5962/p.340574',
'10.5962/p.340575',
'10.5962/p.340576',
'10.5962/p.340577',
'10.5962/p.340578',
'10.5962/p.340579',
'10.5962/p.340580',
'10.5962/p.341013',
'10.5962/p.341014',
'10.5962/p.341169',
'10.5962/p.341170',
);

$count = 1;

$keys = array(
  "timespan", 
  "cited",
  "author_sc", 
  "oci",
  "creation",
  "journal_sc",
  "citing"
);

echo join("\t", $keys) . "\n";

foreach ($dois as $doi)
{

	$url = 'https://opencitations.net/index/coci/api/v1/citations/' . $doi;
	
	$json = get($url);
	$obj = json_decode($json);
	if ($obj)
	{
		foreach ($obj as $item)
		{
			$row = array();
			
			foreach ($keys as $k)
			{
				if (isset($item->{$k}))
				{
					$row[] = $item->{$k};
				}
				else
				{
					$row[] = '';
				}
			}
			echo join("\t", $row) . "\n";
		
		}
	
	}
	
	// Give server a break every 10 items
	if (($count++ % 10) == 0)
	{
		$rand = rand(1000000, 3000000);
		//echo "\n-- ...sleeping for " . round(($rand / 1000000),2) . ' seconds' . "\n\n";
		usleep($rand);
	}
	

}

?>

