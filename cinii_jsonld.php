<?php

//----------------------------------------------------------------------------------------
function get($url, $content_type = '')
{	
	$data = null;

	$opts = array(
	  CURLOPT_URL 				=> $url,
	  CURLOPT_FOLLOWLOCATION	=> TRUE,
	  CURLOPT_RETURNTRANSFER 	=> TRUE,
	  
	  CURLOPT_HEADER 			=> FALSE,
	  
	  CURLOPT_SSL_VERIFYHOST	=> FALSE,
	  CURLOPT_SSL_VERIFYPEER	=> FALSE,
	  
	  CURLOPT_COOKIEJAR			=> sys_get_temp_dir() . '/cookies.txt',
	  CURLOPT_COOKIEFILE		=> sys_get_temp_dir() . '/cookies.txt',
	  
	);

	if ($content_type != '')
	{
		$opts[CURLOPT_HTTPHEADER] = array(
			"Accept: " . $content_type, 
			"Accept-Language: en-gb",
			"User-agent: Mozilla/5.0 (iPad; U; CPU OS 3_2_1 like Mac OS X; en-us) AppleWebKit/531.21.10 (KHTML, like Gecko) Mobile/7B405" 
		);
	}
	
	$ch = curl_init();
	curl_setopt_array($ch, $opts);
	$data = curl_exec($ch);
	$info = curl_getinfo($ch); 
	curl_close($ch);
	
	// echo $data;
	
	return $data;
}

$urls = array(
'https://cir.nii.ac.jp/crid/1130000793647589504',
'https://cir.nii.ac.jp/crid/1520010378559701248',
'https://cir.nii.ac.jp/crid/1520010379796734464',
'https://cir.nii.ac.jp/crid/1520010379843229696',
'https://cir.nii.ac.jp/crid/1520010380183469312',
'https://cir.nii.ac.jp/crid/1520010380317580928',
'https://cir.nii.ac.jp/crid/1520010380381216512',
'https://cir.nii.ac.jp/crid/1520010380392216832',
'https://cir.nii.ac.jp/crid/1520010380439444352',
'https://cir.nii.ac.jp/crid/1520010380464508544',
'https://cir.nii.ac.jp/crid/1520010380489655808',
'https://cir.nii.ac.jp/crid/1520010380512052608',
'https://cir.nii.ac.jp/crid/1520010380513305216',
'https://cir.nii.ac.jp/crid/1520010380543186432',
'https://cir.nii.ac.jp/crid/1520010380657711104',
'https://cir.nii.ac.jp/crid/1520010380674041984',
'https://cir.nii.ac.jp/crid/1520010380697271040',
'https://cir.nii.ac.jp/crid/1520010380780710400',
'https://cir.nii.ac.jp/crid/1520010380790367232',
'https://cir.nii.ac.jp/crid/1520010380848467840',
'https://cir.nii.ac.jp/crid/1520010380856987008',
'https://cir.nii.ac.jp/crid/1520011097109003264',
'https://cir.nii.ac.jp/crid/1520011097113143040',
'https://cir.nii.ac.jp/crid/1520011097114435584',
'https://cir.nii.ac.jp/crid/1520013352849729408',
'https://cir.nii.ac.jp/crid/1520013352850059904',
'https://cir.nii.ac.jp/crid/1520013352850875392',
'https://cir.nii.ac.jp/crid/1520015653964960896',
'https://cir.nii.ac.jp/crid/1520015653971027840',
'https://cir.nii.ac.jp/crid/1520020386448037632',
'https://cir.nii.ac.jp/crid/1520020386448067456',
'https://cir.nii.ac.jp/crid/1520020386448212096',
'https://cir.nii.ac.jp/crid/1520291853574930560',
'https://cir.nii.ac.jp/crid/1520291854787499008',
'https://cir.nii.ac.jp/crid/1520291854796924672',
'https://cir.nii.ac.jp/crid/1520291854859825792',
'https://cir.nii.ac.jp/crid/1520291854880995072',
'https://cir.nii.ac.jp/crid/1520291854898623360',
'https://cir.nii.ac.jp/crid/1520291854909580160',
'https://cir.nii.ac.jp/crid/1520291854926495104',
'https://cir.nii.ac.jp/crid/1520291855040157696',
'https://cir.nii.ac.jp/crid/1520291855204824192',
'https://cir.nii.ac.jp/crid/1520291855231921792',
'https://cir.nii.ac.jp/crid/1520291855296358784',
'https://cir.nii.ac.jp/crid/1520291855495347456',
'https://cir.nii.ac.jp/crid/1520291855524257280',
'https://cir.nii.ac.jp/crid/1520291855623374592',
'https://cir.nii.ac.jp/crid/1520291855645715712',
'https://cir.nii.ac.jp/crid/1520291855683672832',
'https://cir.nii.ac.jp/crid/1520291855903027584',
'https://cir.nii.ac.jp/crid/1520292572089735168',
'https://cir.nii.ac.jp/crid/1520292572089873280',
'https://cir.nii.ac.jp/crid/1520292572089895808',
'https://cir.nii.ac.jp/crid/1520292572091150080',
'https://cir.nii.ac.jp/crid/1520294827826017280',
'https://cir.nii.ac.jp/crid/1520294827826503168',
'https://cir.nii.ac.jp/crid/1520294827826756736',
'https://cir.nii.ac.jp/crid/1520297128944396672',
'https://cir.nii.ac.jp/crid/1520301861424649216',
'https://cir.nii.ac.jp/crid/1520301861424750464',
'https://cir.nii.ac.jp/crid/1520301861424752768',
'https://cir.nii.ac.jp/crid/1520301861424792320',
'https://cir.nii.ac.jp/crid/1520301861424830976',
'https://cir.nii.ac.jp/crid/1520301861424859392',
'https://cir.nii.ac.jp/crid/1520301861424920960',
'https://cir.nii.ac.jp/crid/1520301861424938880',
'https://cir.nii.ac.jp/crid/1520301861424946432',
'https://cir.nii.ac.jp/crid/1520301861424973056',
'https://cir.nii.ac.jp/crid/1520301861424998272',
'https://cir.nii.ac.jp/crid/1520573329754357248',
'https://cir.nii.ac.jp/crid/1520573329915232640',
'https://cir.nii.ac.jp/crid/1520573329938061568',
'https://cir.nii.ac.jp/crid/1520573329995976960',
'https://cir.nii.ac.jp/crid/1520573330150707328',
'https://cir.nii.ac.jp/crid/1520573330257047552',
'https://cir.nii.ac.jp/crid/1520573330331268864',
'https://cir.nii.ac.jp/crid/1520573330493674880',
'https://cir.nii.ac.jp/crid/1520573330894451840',
'https://cir.nii.ac.jp/crid/1520573331213666688',
'https://cir.nii.ac.jp/crid/1520573331213973248',
'https://cir.nii.ac.jp/crid/1520574047062203904',
'https://cir.nii.ac.jp/crid/1520574047064384384',
'https://cir.nii.ac.jp/crid/1520576302802653184',
'https://cir.nii.ac.jp/crid/1520578603917622912',
'https://cir.nii.ac.jp/crid/1520578603918006912',
'https://cir.nii.ac.jp/crid/1520578603922167296',
'https://cir.nii.ac.jp/crid/1520578603922179584',
'https://cir.nii.ac.jp/crid/1520578603923167488',
'https://cir.nii.ac.jp/crid/1520583336401354496',
'https://cir.nii.ac.jp/crid/1520583336401468928',
'https://cir.nii.ac.jp/crid/1520583336401515776',
'https://cir.nii.ac.jp/crid/1520583336401517568',
'https://cir.nii.ac.jp/crid/1520583336401541120',
'https://cir.nii.ac.jp/crid/1520583336401577856',
'https://cir.nii.ac.jp/crid/1520583336401583872',
'https://cir.nii.ac.jp/crid/1520583336401625600',
'https://cir.nii.ac.jp/crid/1520583336401633664',
'https://cir.nii.ac.jp/crid/1520583336401652608',
'https://cir.nii.ac.jp/crid/1520583336401702272',
'https://cir.nii.ac.jp/crid/1520583336401716992',
'https://cir.nii.ac.jp/crid/1520854804709551360',
'https://cir.nii.ac.jp/crid/1520854804756624000',
'https://cir.nii.ac.jp/crid/1520854804840975360',
'https://cir.nii.ac.jp/crid/1520854804851819776',
'https://cir.nii.ac.jp/crid/1520854805027497600',
'https://cir.nii.ac.jp/crid/1520854805586906368',
'https://cir.nii.ac.jp/crid/1520854805606111104',
'https://cir.nii.ac.jp/crid/1520854805607371520',
'https://cir.nii.ac.jp/crid/1520854805646526720',
'https://cir.nii.ac.jp/crid/1520854805705685120',
'https://cir.nii.ac.jp/crid/1520854805748061952',
'https://cir.nii.ac.jp/crid/1520854805761763200',
'https://cir.nii.ac.jp/crid/1520854805770812160',
'https://cir.nii.ac.jp/crid/1520854805871821312',
'https://cir.nii.ac.jp/crid/1520854805930296704',
'https://cir.nii.ac.jp/crid/1520854806190549248',
'https://cir.nii.ac.jp/crid/1520855522043319424',
'https://cir.nii.ac.jp/crid/1520855522045375104',
'https://cir.nii.ac.jp/crid/1520857777779880192',
'https://cir.nii.ac.jp/crid/1520857777779881216',
'https://cir.nii.ac.jp/crid/1520857777779898624',
'https://cir.nii.ac.jp/crid/1520857777780963328',
'https://cir.nii.ac.jp/crid/1520857777780989056',
'https://cir.nii.ac.jp/crid/1520860078892780928',
'https://cir.nii.ac.jp/crid/1520860078893103872',
'https://cir.nii.ac.jp/crid/1520860078897235200',
'https://cir.nii.ac.jp/crid/1520864811378191744',
'https://cir.nii.ac.jp/crid/1520864811378298240',
'https://cir.nii.ac.jp/crid/1521136278467065344',
'https://cir.nii.ac.jp/crid/1521136278519036416',
'https://cir.nii.ac.jp/crid/1521136279756236416',
'https://cir.nii.ac.jp/crid/1521136279853170560',
'https://cir.nii.ac.jp/crid/1521136279878324096',
'https://cir.nii.ac.jp/crid/1521136280013295616',
'https://cir.nii.ac.jp/crid/1521136280045720192',
'https://cir.nii.ac.jp/crid/1521136280144327168',
'https://cir.nii.ac.jp/crid/1521136280268412672',
'https://cir.nii.ac.jp/crid/1521136280359645952',
'https://cir.nii.ac.jp/crid/1521136280493955072',
'https://cir.nii.ac.jp/crid/1521136280588722688',
'https://cir.nii.ac.jp/crid/1521136280642455296',
'https://cir.nii.ac.jp/crid/1521136280728887936',
'https://cir.nii.ac.jp/crid/1521136280761596928',
'https://cir.nii.ac.jp/crid/1521136280857625984',
'https://cir.nii.ac.jp/crid/1521136280860563584',
'https://cir.nii.ac.jp/crid/1521136280865788928',
'https://cir.nii.ac.jp/crid/1521136280876980736',
'https://cir.nii.ac.jp/crid/1521136280974411008',
'https://cir.nii.ac.jp/crid/1521136281167155840',
'https://cir.nii.ac.jp/crid/1521136281167182592',
'https://cir.nii.ac.jp/crid/1521417754700119936',
'https://cir.nii.ac.jp/crid/1521417754713543808',
'https://cir.nii.ac.jp/crid/1521417754746988416',
'https://cir.nii.ac.jp/crid/1521417754753656832',
'https://cir.nii.ac.jp/crid/1521417754974274432',
'https://cir.nii.ac.jp/crid/1521417755017731328',
'https://cir.nii.ac.jp/crid/1521417755070858752',
'https://cir.nii.ac.jp/crid/1521417755283695616',
'https://cir.nii.ac.jp/crid/1521417755567242368',
'https://cir.nii.ac.jp/crid/1521417756143915776',
'https://cir.nii.ac.jp/crid/1521699229685140864',
'https://cir.nii.ac.jp/crid/1521699229778516224',
'https://cir.nii.ac.jp/crid/1521699230049220864',
'https://cir.nii.ac.jp/crid/1521699230115305600',
'https://cir.nii.ac.jp/crid/1521699230146141568',
'https://cir.nii.ac.jp/crid/1521699230149926400',
'https://cir.nii.ac.jp/crid/1521699230178571392',
'https://cir.nii.ac.jp/crid/1521699230212076544',
'https://cir.nii.ac.jp/crid/1521699230422111488',
'https://cir.nii.ac.jp/crid/1521699230459143424',
'https://cir.nii.ac.jp/crid/1521699230469603968',
'https://cir.nii.ac.jp/crid/1521699230575785216',
'https://cir.nii.ac.jp/crid/1521699230727078016',
'https://cir.nii.ac.jp/crid/1521699230784993408',
'https://cir.nii.ac.jp/crid/1521699231120408320',
'https://cir.nii.ac.jp/crid/1521699231120602240',
'https://cir.nii.ac.jp/crid/1521980704657576832',
'https://cir.nii.ac.jp/crid/1521980704767228544',
'https://cir.nii.ac.jp/crid/1521980704794265856',
'https://cir.nii.ac.jp/crid/1521980704869765504',
'https://cir.nii.ac.jp/crid/1521980704869978496',
'https://cir.nii.ac.jp/crid/1521980705147013888',
'https://cir.nii.ac.jp/crid/1521980705195103360',
'https://cir.nii.ac.jp/crid/1521980705212669696',
'https://cir.nii.ac.jp/crid/1521980705225280256',
'https://cir.nii.ac.jp/crid/1521980705243242240',
'https://cir.nii.ac.jp/crid/1521980705365648256',
'https://cir.nii.ac.jp/crid/1521980705417810560',
'https://cir.nii.ac.jp/crid/1521980705442836352',
'https://cir.nii.ac.jp/crid/1521980705496709632',
'https://cir.nii.ac.jp/crid/1521980705497190656',
'https://cir.nii.ac.jp/crid/1521980705622219776',
'https://cir.nii.ac.jp/crid/1521980705640088064',
'https://cir.nii.ac.jp/crid/1521980705782731648',
'https://cir.nii.ac.jp/crid/1521980706097377920',
'https://cir.nii.ac.jp/crid/1521980706097426688',
'https://cir.nii.ac.jp/crid/1522262178368624256',
'https://cir.nii.ac.jp/crid/1522262178405599616',
'https://cir.nii.ac.jp/crid/1522262179630664448',
'https://cir.nii.ac.jp/crid/1522262179677918464',
'https://cir.nii.ac.jp/crid/1522262179711141120',
'https://cir.nii.ac.jp/crid/1522262179807774976',
'https://cir.nii.ac.jp/crid/1522262179823171712',
'https://cir.nii.ac.jp/crid/1522262179894621696',
'https://cir.nii.ac.jp/crid/1522262180007376256',
'https://cir.nii.ac.jp/crid/1522262180249729536',
'https://cir.nii.ac.jp/crid/1522262180497743104',
'https://cir.nii.ac.jp/crid/1522262180538134784',
'https://cir.nii.ac.jp/crid/1522262180568312192',
'https://cir.nii.ac.jp/crid/1522262180689965568',
'https://cir.nii.ac.jp/crid/1522262180694854528',
'https://cir.nii.ac.jp/crid/1522262180695347328',
'https://cir.nii.ac.jp/crid/1522262180707276032',
'https://cir.nii.ac.jp/crid/1522262180782819968',
'https://cir.nii.ac.jp/crid/1522262180807942272',
'https://cir.nii.ac.jp/crid/1522262180811936640',
'https://cir.nii.ac.jp/crid/1522543654670139520',
'https://cir.nii.ac.jp/crid/1522543654829815168',
'https://cir.nii.ac.jp/crid/1522543654887761536',
'https://cir.nii.ac.jp/crid/1522543654929086080',
'https://cir.nii.ac.jp/crid/1522543655029269632',
'https://cir.nii.ac.jp/crid/1522543655084267776',
'https://cir.nii.ac.jp/crid/1522543655304838784',
'https://cir.nii.ac.jp/crid/1522543655324209536',
'https://cir.nii.ac.jp/crid/1522543655389427072',
'https://cir.nii.ac.jp/crid/1522543655468967808',
'https://cir.nii.ac.jp/crid/1522543655561373696',
'https://cir.nii.ac.jp/crid/1522543655565731072',
'https://cir.nii.ac.jp/crid/1522543655574457472',
'https://cir.nii.ac.jp/crid/1522543655580776960',
'https://cir.nii.ac.jp/crid/1522543655613250816',
'https://cir.nii.ac.jp/crid/1522543655711212032',
'https://cir.nii.ac.jp/crid/1522543655802994688',
'https://cir.nii.ac.jp/crid/1522825128315259008',
'https://cir.nii.ac.jp/crid/1522825128320250496',
'https://cir.nii.ac.jp/crid/1522825129767009536',
'https://cir.nii.ac.jp/crid/1522825129777225216',
'https://cir.nii.ac.jp/crid/1522825129786484992',
'https://cir.nii.ac.jp/crid/1522825129870598784',
'https://cir.nii.ac.jp/crid/1522825129951487360',
'https://cir.nii.ac.jp/crid/1522825129961678464',
'https://cir.nii.ac.jp/crid/1522825130105003008',
'https://cir.nii.ac.jp/crid/1522825130202427648',
'https://cir.nii.ac.jp/crid/1522825130239445760',
'https://cir.nii.ac.jp/crid/1522825130363121664',
'https://cir.nii.ac.jp/crid/1522825130552076160',
'https://cir.nii.ac.jp/crid/1522825130614350592',
'https://cir.nii.ac.jp/crid/1523106603308186240',
'https://cir.nii.ac.jp/crid/1523106604536722944',
'https://cir.nii.ac.jp/crid/1523106604550705408',
'https://cir.nii.ac.jp/crid/1523106604761640960',
'https://cir.nii.ac.jp/crid/1523106604771331968',
'https://cir.nii.ac.jp/crid/1523106604851560704',
'https://cir.nii.ac.jp/crid/1523106605209326464',
'https://cir.nii.ac.jp/crid/1523106605272673536',
'https://cir.nii.ac.jp/crid/1523106605314223104',
'https://cir.nii.ac.jp/crid/1523106605517818112',
'https://cir.nii.ac.jp/crid/1523106605554348288',
'https://cir.nii.ac.jp/crid/1523106605593149696',
'https://cir.nii.ac.jp/crid/1523106605616872832',
'https://cir.nii.ac.jp/crid/1523106605684586368',
'https://cir.nii.ac.jp/crid/1523106606004386816',
'https://cir.nii.ac.jp/crid/1523388079527716864',
'https://cir.nii.ac.jp/crid/1523388079550517888',
'https://cir.nii.ac.jp/crid/1523388079714977280',
'https://cir.nii.ac.jp/crid/1523388079845311488',
'https://cir.nii.ac.jp/crid/1523388079857107456',
'https://cir.nii.ac.jp/crid/1523388079914463616',
'https://cir.nii.ac.jp/crid/1523388079956319104',
'https://cir.nii.ac.jp/crid/1523388079956811520',
'https://cir.nii.ac.jp/crid/1523388080039318528',
'https://cir.nii.ac.jp/crid/1523388080221868800',
'https://cir.nii.ac.jp/crid/1523388080233946880',
'https://cir.nii.ac.jp/crid/1523388080358429440',
'https://cir.nii.ac.jp/crid/1523388080377086976',
'https://cir.nii.ac.jp/crid/1523388080629791232',
'https://cir.nii.ac.jp/crid/1523388080651714304',
'https://cir.nii.ac.jp/crid/1523669553280462464',
'https://cir.nii.ac.jp/crid/1523669553284131456',
'https://cir.nii.ac.jp/crid/1523669553284517888',
'https://cir.nii.ac.jp/crid/1523669554625889920',
'https://cir.nii.ac.jp/crid/1523669554770884992',
'https://cir.nii.ac.jp/crid/1523669554869817344',
'https://cir.nii.ac.jp/crid/1523669554981043712',
'https://cir.nii.ac.jp/crid/1523669555088086144',
'https://cir.nii.ac.jp/crid/1523669555230479744',
'https://cir.nii.ac.jp/crid/1523669555320926080',
'https://cir.nii.ac.jp/crid/1523669555413834880',
'https://cir.nii.ac.jp/crid/1523669555502900736',
'https://cir.nii.ac.jp/crid/1523669555546107520',
'https://cir.nii.ac.jp/crid/1523669555687722880',
'https://cir.nii.ac.jp/crid/1523669555957578112',
'https://cir.nii.ac.jp/crid/1523951028247151488',
'https://cir.nii.ac.jp/crid/1523951028254281856',
'https://cir.nii.ac.jp/crid/1523951028277055872',
'https://cir.nii.ac.jp/crid/1523951029486201728',
'https://cir.nii.ac.jp/crid/1523951029508303744',
'https://cir.nii.ac.jp/crid/1523951029759017856',
'https://cir.nii.ac.jp/crid/1523951030056635520',
'https://cir.nii.ac.jp/crid/1523951030090800384',
'https://cir.nii.ac.jp/crid/1523951030186714624',
'https://cir.nii.ac.jp/crid/1523951030215388160',
'https://cir.nii.ac.jp/crid/1523951030249082112',
'https://cir.nii.ac.jp/crid/1523951030274844416',
'https://cir.nii.ac.jp/crid/1523951030401263232',
'https://cir.nii.ac.jp/crid/1523951030487109504',
'https://cir.nii.ac.jp/crid/1523951030582524544',
'https://cir.nii.ac.jp/crid/1523951030618334208',
'https://cir.nii.ac.jp/crid/1523951030934412416',
'https://cir.nii.ac.jp/crid/1524232503243548288',
'https://cir.nii.ac.jp/crid/1524232504555457408',
'https://cir.nii.ac.jp/crid/1524232504587173376',
'https://cir.nii.ac.jp/crid/1524232504645175808',
'https://cir.nii.ac.jp/crid/1524232504651631360',
'https://cir.nii.ac.jp/crid/1524232504654584832',
'https://cir.nii.ac.jp/crid/1524232504675766656',
'https://cir.nii.ac.jp/crid/1524232504814633728',
'https://cir.nii.ac.jp/crid/1524232504939752320',
'https://cir.nii.ac.jp/crid/1524232504970031744',
'https://cir.nii.ac.jp/crid/1524232505407098112',
'https://cir.nii.ac.jp/crid/1524232505419939328',
'https://cir.nii.ac.jp/crid/1524232505504368128',
'https://cir.nii.ac.jp/crid/1524232505511298432',
'https://cir.nii.ac.jp/crid/1524232505567476864',
'https://cir.nii.ac.jp/crid/1524232505591695104',
'https://cir.nii.ac.jp/crid/1524232505627638272',
'https://cir.nii.ac.jp/crid/1524232505732213760',
'https://cir.nii.ac.jp/crid/1524232505910705920',
'https://cir.nii.ac.jp/crid/1524232505911227520',

);

$count = 1;

foreach ($urls as $url)
{
	$json = get($url . '.json');
	
	// just get titles
	$obj = json_decode($json);
	
	if (isset($obj->{'dc:title'}))
	{
		foreach ($obj->{'dc:title'} as $title)
		{
			if (isset($title->{'@language'}))
			{
				// handle 'ja-Kana'
				$language = substr($title->{'@language'}, 0, 2);
				
				// CiNii may get the language wrong
				
				if (!preg_match('/\p{Hiragana}+/u', $title->{'@value'})
					&& !preg_match('/\p{Katakana}+/u', $title->{'@value'})
					&& !preg_match('/\p{Han}+/u', $title->{'@value'}))
				{
					$language = 'en';
				}  				
			
				echo 'REPLACE INTO multilingual(guid, `key`, language, value) VALUES("' . $url . '","title","' . $language . '","' . str_replace('"', '""', $title->{'@value'}) . '");' . "\n";

			}
		}
	}
	
	// Give server a break every 10 items
	if (($count++ % 5) == 0)
	{
		$rand = rand(1000000, 3000000);
		echo "\n-- ...sleeping for " . round(($rand / 1000000),2) . ' seconds' . "\n\n";
		usleep($rand);
	}		
}

?>
